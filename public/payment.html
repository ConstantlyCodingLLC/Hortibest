<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - Hortibest</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://sandbox.web.squarecdn.com/v1/square.js"></script>
<style>
body {
  font-family:'Montserrat', sans-serif;
  background:#0d0d0d;
  color:#fff;
  margin:0;
  padding:0;
}

/* HEADER */
header {
  position:fixed;
  top:0;
  width:100%;
  background:rgba(0,0,0,0.9);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:1rem 2rem;
  z-index:1000;
  flex-wrap:wrap;
}
header img { height:50px; cursor:pointer; }
nav ul { display:flex; list-style:none; gap:1rem; padding:0; margin:0; }
nav ul li a {
  background:#3498db;
  color:#fff;
  padding:0.5rem 0.8rem;
  border-radius:6px;
  font-weight:600;
  text-decoration:none;
  transition:background 0.3s;
}
nav ul li a:hover { background:#2980b9; }

/* MAIN CHECKOUT */
main {
  margin-top:120px;
  max-width:1000px;
  margin-inline:auto;
  padding:2rem;
  display:grid;
  gap:2rem;
  grid-template-columns:1fr 1fr;
}
h2 { font-weight:800; font-size:1.8rem; margin-bottom:1rem; color:#fff; }
.section-box {
  background:#111;
  padding:2rem;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,0.6);
}
label { display:block; margin-bottom:0.3rem; font-weight:600; }
input, select {
  width:100%;
  padding:0.7rem;
  background:#222;
  color:#fff;
  border:none;
  border-radius:6px;
  margin-bottom:1rem;
  box-sizing:border-box;
}
select option { color:#000; }

#cart-summary h3 { margin-bottom:1rem; border-bottom:1px solid #333; padding-bottom:0.5rem; }
.cart-item { display:flex; justify-content:space-between; margin-bottom:0.5rem; color:#ccc; }
.cart-total { border-top:1px solid #333; margin-top:1rem; padding-top:0.5rem; font-weight:700; color:#fff; }

/* PAYMENT METHODS */
.payment-options {
  display:flex;
  gap:0.3rem;
  margin-bottom:1rem;
}
.payment-options button {
  flex:1;
  background:#333;
  border:none;
  color:#fff;
  padding:0.5rem;
  border-radius:6px;
  cursor:pointer;
  font-size:0.85rem;
  font-weight:600;
  text-align:center;
  transition:background 0.3s, transform 0.3s;
}
.payment-options button.active,
.payment-options button:hover { background:#3498db; transform:translateY(-1px); }

#card-container { margin-bottom:1rem; }
.pay-btn {
  background:#9b59b6;
  border:none;
  color:#fff;
  font-weight:700;
  padding:0.8rem;
  border-radius:8px;
  width:100%;
  cursor:pointer;
  transition:background 0.3s, transform 0.3s;
}
.pay-btn:hover { background:#8e44ad; transform:translateY(-1px); }
#payment-status { margin-top:1rem; text-align:center; color:#ccc; }

/* RESPONSIVE */
@media(max-width:900px){ main { grid-template-columns:1fr; } }
</style>
</head>
<body>

<header>
  <a href="index.html"><img src="https://ueeshop.ly200-cdn.com/u_file/UPAR/UPAR370/2507/photo/235adfacf1.png" alt="Hortibest Logo"></a>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="vertical-farm.html">Vertical Farm</a></li>
      <li><a href="greenhouse.html">Greenhouse</a></li>
    </ul>
  </nav>
</header>

<main>
  <!-- LEFT: SHIPPING & MEMBER -->
  <div class="section-box">
    <h2>Shipping & Member</h2>

    <label for="memberId">Member ID (Optional)</label>
    <input type="text" id="memberId" placeholder="Enter Member ID">

    <label for="fullName">Full Name</label>
    <input type="text" id="fullName" placeholder="John Doe" required>

    <label for="email">Email</label>
    <input type="text" id="email" placeholder="johndoe@example.com" required>

    <label for="address">Shipping Address</label>
    <input type="text" id="address" placeholder="1234 Greenhouse St" required>

    <label for="city">City</label>
    <input type="text" id="city" placeholder="Los Angeles" required>

    <label for="zip">Postal Code</label>
    <input type="text" id="zip" placeholder="90001" required>

    <label for="shippingMethod">Shipping Method</label>
    <select id="shippingMethod">
      <option value="Standard">Standard Shipping - $15</option>
      <option value="Express">Express Shipping - $35</option>
      <option value="Pickup">Store Pickup - Free</option>
    </select>
  </div>

  <!-- RIGHT: CART & PAYMENT -->
  <div class="section-box">
    <h2>Order Summary</h2>
    <div id="cart-summary"></div>

    <h2>Payment</h2>
    <div class="payment-options">
      <button id="payCard" class="active">Credit/Debit</button>
      <button id="payPayPal">PayPal</button>
    </div>

    <div id="card-container"></div>
    <button class="pay-btn" id="payNow">Pay Now</button>
    <div id="payment-status"></div>
  </div>
</main>

<script>
// Members with discounts
const members = { "MEMBER1001":10, "MEMBER1002":15, "VIP2025":20 };

// Load cart from localStorage
let cart = JSON.parse(localStorage.getItem('cartData')) || [];
let total = cart.reduce((sum, i) => sum + i.price, 0);

const cartSummary = document.getElementById('cart-summary');
const shippingSelect = document.getElementById('shippingMethod');
const memberInput = document.getElementById('memberId');

function renderCart() {
  let shippingCost = 0;
  const shippingMethod = shippingSelect.value;
  if(shippingMethod==='Standard') shippingCost=15;
  else if(shippingMethod==='Express') shippingCost=35;

  let newTotal = total + shippingCost;

  const memberId = memberInput.value.trim();
  let discount = 0;
  if(memberId && members[memberId]){
    discount = members[memberId];
    newTotal = newTotal * (1 - discount/100);
  }

  cartSummary.innerHTML = `
    ${cart.length ? cart.map(i => `<div class="cart-item"><span>${i.name}</span><span>$${i.price.toFixed(2)}</span></div>`).join('') : '<p>Your cart is empty.</p>'}
    <div class="cart-total">Subtotal: $${total.toFixed(2)}</div>
    <div class="cart-total">Shipping: $${shippingCost.toFixed(2)}</div>
    ${discount>0? `<div class="cart-total">Member Discount: ${discount}%</div>` : ''}
    <div class="cart-total" style="font-size:1.2rem;">Total: $${newTotal.toFixed(2)}</div>
  `;
}

// Update cart when shipping or member ID changes
shippingSelect.addEventListener('change', renderCart);
memberInput.addEventListener('input', renderCart);

// Initial render
renderCart();

// Payment toggle
const payCardBtn = document.getElementById('payCard');
const payPayPalBtn = document.getElementById('payPayPal');
payCardBtn.addEventListener('click', ()=>{
  payCardBtn.classList.add('active');
  payPayPalBtn.classList.remove('active');
  document.getElementById('card-container').style.display='block';
});
payPayPalBtn.addEventListener('click', ()=>{
  payCardBtn.classList.remove('active');
  payPayPalBtn.classList.add('active');
  document.getElementById('card-container').style.display='none';
});

// Square payment integration (replace with real IDs)
const appId = "REPLACE_WITH_YOUR_SQUARE_APP_ID";
const locationId = "REPLACE_WITH_YOUR_LOCATION_ID";

async function initializeSquare(){
  if(!window.Square){ document.getElementById('payment-status').innerText="Square SDK failed to load."; return; }
  const payments = window.Square.payments(appId, locationId);
  const card = await payments.card();
  await card.attach('#card-container');

  document.getElementById('payNow').addEventListener('click', async ()=>{
    const method = document.querySelector('.payment-options button.active').id;
    const statusEl = document.getElementById('payment-status');
    statusEl.textContent = "Processing...";
    if(method==="payCard"){
      try{
        const result = await card.tokenize();
        if(result.status==='OK'){
          console.log("Token:", result.token);
          statusEl.textContent="Payment successful! (Token logged to console)";
        } else throw new Error(result.errors ? result.errors[0].message : "Payment failed.");
      }catch(err){ statusEl.textContent="Error: "+err.message; }
    } else {
      statusEl.textContent="Redirecting to PayPal...";
      setTimeout(()=>window.location.href="https://www.paypal.com/checkoutnow",1000);
    }
  });
}

initializeSquare();
</script>
</body>
</html>
